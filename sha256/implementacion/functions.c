/*******************************************************************************************************************************//**
 *
 * @file		functions.c
 * @brief       Implementacion de funciones para calcular el hash de un archivo con sha256
 * @date
 * @author
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "functions.h"
#include <stdio.h>
#include <string.h>
#include "sha256.h"
#include <stdint.h>
#include <stdlib.h>

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/


/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/


/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/


/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/


/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/


/***********************************************************************************************************************************
 *** VARIABLES GLOBLES PRIVADAS AL MODULO
 **********************************************************************************************************************************/


/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/


/***********************************************************************************************************************************
*** CONFIGURACION DE ERRORES
**********************************************************************************************************************************/


/***********************************************************************************************************************************
 *** IMPLEMENTACION DE FUNCIONES PUBLICAS
 **********************************************************************************************************************************/
BYTE * sha256File(const char *filename)
{
    FILE *file;
    BYTE buf[16];
    SHA256_CTX ctx;
    uint8_t * out = (uint8_t *) malloc(SHA256_BLOCK_SIZE*sizeof(uint8_t));

    sha256_init(&ctx);

    file = fopen(filename, "r");

    if (file == NULL)
        return NULL;
    else
    {
        uint8_t r = 0;
        do
        {
            memset(buf, 0, 16);
            r = fread(buf, sizeof(uint8_t), 16, file);
            if (r != 0)
            {
                sha256_update(&ctx, buf, strlen((char *)buf));
            }
        } while (r != 0);
    }
    fclose(file);

    sha256_final(&ctx, out);

    return out;
}

void printHash(const BYTE * hash, const size_t size)
{
    int i;
    for (i = 0; i < size; i++)
    {
        if (i > 0)
            printf(":");
        printf("%02X", hash[i]);
    }
    printf("\n");
}


/***********************************************************************************************************************************
 *** IMPLEMNTACION DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/*--------------------------------------------------------------------------------------------------------------------------------*/